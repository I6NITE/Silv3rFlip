<!DOCTYPE html>
<html>

<head>
    <title>Silv3rFlip</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #1c2833, #2e4053);
            color: #ecf0f1;
            display: flex;
            min-height: 100vh;
            margin: 0;
        }
        
        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            flex-grow: 1;
        }
        
        #title-container {
            position: absolute;
            top: 10px;
            left: 10px;
            display: flex;
            align-items: center;
        }
        
        #title {
            font-size: 1.5em;
            font-weight: bold;
            margin-right: 5px;
        }
        
        #user-icon {
            width: 24px;
            height: 24px;
            background-image: url('https://icon-library.com/images/profile-icon-white/profile-icon-white-1.jpg');
            background-size: cover;
            margin-right: 5px;
        }
        
        #logout-button-title {
            background-color: #e74c3c;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            margin-left: 5px;
        }
        
        #robux-display {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px 20px;
            border-radius: 5px;
            margin: 20px 0;
            font-size: 1.2em;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
        }
        
        #controls {
            background-color: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            width: 350px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        #controls label,
        #controls span,
        #controls p {
            display: block;
            margin-bottom: 5px;
        }
        
        #controls input,
        #controls button {
            font-size: 1.1em;
            padding: 10px 15px;
            margin: 5px;
            border: none;
            border-radius: 5px;
        }
        
        #controls input {
            background-color: #34495e;
            color: #ecf0f1;
        }
        
        #controls button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        #controls button:hover {
            background-color: #2980b9;
        }
        
        #board {
            display: grid;
            grid-gap: 8px;
            width: 400px;
            margin: 0 auto;
            background-color: #2c3e50;
            padding: 10px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .cell {
            width: 70px;
            height: 70px;
            border: 2px solid #34495e;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            font-size: 2.5em;
            user-select: none;
            background-color: #34495e;
            color: #ecf0f1;
            transition: background-color 0.3s ease;
        }
        
        .cell:hover {
            background-color: #4a6572;
        }
        
        .revealed {
            border: 2px solid #2980b9;
            background-color: #3498db;
        }
        
        .mine {
            background-color: #e74c3c;
            color: white;
        }
        
        #message {
            margin-top: 10px;
            color: #e67e22;
        }
        
        #admin-panel {
            background-color: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
            width: 350px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
            position: absolute;
            cursor: move;
            display: none;
        }
        
        #admin-panel input,
        #admin-panel button {
            margin: 5px;
            padding: 8px 15px;
            font-size: 1em;
        }
        
        #deposit-button {
            background-color: #2ecc71;
            color: white;
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            margin-left: 10px;
            transition: background-color 0.3s ease;
        }
        
        #deposit-button:hover {
            background-color: #27ae60;
        }
        
        #deposit-modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }
        
        #deposit-modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 10px;
            color: black;
            text-align: center;
        }
        
        #deposit-modal-content input,
        #deposit-modal-content button {
            margin: 5px;
            padding: 8px 15px;
            font-size: 1em;
        }
    </style>
</head>

<body>
    <div id="game-container">
        <div id="title-container">
            <div id="title"></div>
            <div id="user-icon"></div>
            <button id="logout-button-title" onclick="logout()">Logout</button>
        </div>

        <div id="robux-display">
            Robux: <span id="currentRobux"> 0.00</span>
            <button id="deposit-button" onclick="openDepositModal()">Deposit</button>
        </div>

        <div id="controls">
            <label for="mines">Mines (1-24):</label>
            <input type="number" id="mines" value="3" min="1" max="24">
            <p>Current Bet: <span id="currentBet">0</span></p>
            <label for="betAmount">Bet Amount:</label>
            <input type="number" id="betAmount" value="1">
            <button onclick="placeBet()">Place Bet</button>
            <button onclick="pickRandomTile()">Pick Random Tile</button>
            <button onclick="cashOut()" disabled>Cash Out</button>
            <p>Multiplier: <span id="multiplier">1.00</span></p>
            <p id="message"></p>
        </div>

        <div id="board"></div>

        <div id="admin-panel">
            <h2>Admin Panel</h2>
            <input type="number" id="adminRobuxAmount" placeholder="Robux to Add">
            <button onclick="addRobux()">Add Robux</button>
        </div>
    </div>

    <div id="deposit-modal">
        <div id="deposit-modal-content">
            <h2>Deposit Robux</h2>
            <input type="text" id="depositCode" placeholder="Enter Code">
            <button onclick="redeemCode()">Redeem</button>
            <button onclick="closeDepositModal()">Cancel</button>
        </div>
    </div>

    <script>
        let board = [];
        const rows = 5;
        const cols = 5;
        let mineCount = 3;
        let revealedCells = 0;
        let gameActive = false;
        let bet = 0;
        let currentMultiplier = 1.00;
        let safeCells = [];
        let gameStarted = false;
        let dragElement = null;
        let offsetX, offsetY;

        function getRobuxKey(user) {
            return `robux_${user || 'guest'}`;
        }

        function getRobux() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            const robuxKey = getRobuxKey(loggedInUser);
            return parseFloat(localStorage.getItem(robuxKey)) || 0.00;
        }

        function saveRobux(robuxValue) {
            const loggedInUser = localStorage.getItem('loggedInUser');
            const robuxKey = getRobuxKey(loggedInUser);
            localStorage.setItem(robuxKey, robuxValue.toFixed(2));
        }

        let robux = getRobux();

        document.getElementById("currentRobux").textContent = robux.toFixed(2);

        const loggedInUser = localStorage.getItem('loggedInUser');
        if (loggedInUser) {
            document.getElementById('title').textContent = loggedInUser;
            if (loggedInUser === "Silv3rGtr") {
                document.getElementById("admin-panel").style.display = "block";
            }
        } else {
            window.location.href = "Silv3rFlip.html";
        }

        document.getElementById("admin-panel").addEventListener("mousedown", dragMouseDown);

        function dragMouseDown(e) {
            e = e || window.event;
            dragElement = e.target.closest('#admin-panel');
            if (!dragElement || e.target.tagName === 'INPUT' || e.target.tagName === 'BUTTON') return;
            e.preventDefault();
            offsetX = e.clientX - dragElement.offsetLeft;
            offsetY = e.clientY - dragElement.offsetTop;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }

        function elementDrag(e) {
            if (!dragElement) return;
            e = e || window.event;
            e.preventDefault();
            dragElement.style.left = (e.clientX - offsetX) + "px";
            dragElement.style.top = (e.clientY - offsetY) + "px";
        }

        function closeDragElement() {
            document.onmouseup = null;
            document.onmousemove = null;
            dragElement = null;
        }

        function placeBet() {
            if (gameStarted) {
                document.getElementById("message").textContent = "You cannot place another bet during an active round.";
                return;
            }

            const betInput = document.getElementById("betAmount");
            const betValue = parseInt(betInput.value, 10);
            if (betValue > 0 && betValue <= robux) {
                bet = betValue;
                document.getElementById("currentBet").textContent = bet;
                robux -= bet;
                document.getElementById("currentRobux").textContent = robux.toFixed(2);
                startGame();
                gameStarted = true;
                saveRobux(robux);
            } else {
                if (betValue > robux) {
                    document.getElementById("message").textContent = "Insufficient Robux.";
                } else {
                    document.getElementById("message").textContent = "Please enter a valid bet amount.";
                }
            }
        }

        function startGame() {
            mineCount = parseInt(document.getElementById("mines").value, 10);
            if (mineCount < 1) {
                document.getElementById("message").textContent = "Mines must be between 1 and 24";
                return;
            }
            revealedCells = 0;
            gameActive = true;
            currentMultiplier = 1.00;
            document.getElementById("message").textContent = "";
            document.getElementById("multiplier").textContent = currentMultiplier.toFixed(2);
            safeCells = [];

            generateBoard();
            renderBoard();
            document.querySelector("#controls button[onclick='cashOut()']").disabled = false;
        }

        function generateBoard() {
            board = [];
            for (let i = 0; i < rows; i++) {
                board.push(Array(cols).fill(0));
            }

            let minesPlaced = 0;
            while (minesPlaced < mineCount) {
                const row = Math.floor(Math.random() * rows);
                const col = Math.floor(Math.random() * cols);
                if (board[row][col] === 0) {
                    board[row][col] = "M";
                    minesPlaced++;
                }
            }
        }

        function renderBoard() {
            const boardElement = document.getElementById("board");
            boardElement.innerHTML = "";
            boardElement.style.gridTemplateColumns = `repeat(${cols}, 78px)`;

            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    const cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener("click", function() {
                        handleCellClick(i, j);
                    });
                    boardElement.appendChild(cell);
                }
            }
        }

        function handleCellClick(row, col) {
            if (!gameActive) return;
            const cellElement = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            if (cellElement.classList.contains("revealed")) return;

            let isMine = board[row][col] === "M";

            if (isMine) {
                revealMines();
                document.getElementById("message").textContent = "You hit a mine! Game over.";
                gameActive = false;
                document.querySelector("#controls button[onclick='cashOut()']").disabled = true;
                gameStarted = false;
                return;
            }

            cellElement.classList.add("revealed");
            revealedCells++;
            safeCells.push({
                row,
                col
            });

            currentMultiplier = calculateMultiplier(revealedCells);
            document.getElementById("multiplier").textContent = currentMultiplier.toFixed(2);

            if (revealedCells + mineCount === rows * cols) {
                cashOut();
            }
        }

        function calculateMultiplier(revealed) {
            const mineFactor = (mineCount / 24) * 0.10;
            const baseMultiplier = 1.08 + mineFactor;
            return baseMultiplier ** revealed;
        }

        function revealMines() {
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (board[i][j] === "M") {
                        const cellElement = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                        if (!cellElement.classList.contains("revealed")) {
                            cellElement.classList.add("mine");
                            cellElement.textContent = "M";
                        }
                    }
                }
            }
        }

        function cashOut() {
            if (!gameActive && revealedCells === 0) return;

            const winnings = bet * currentMultiplier;
            document.getElementById("message").textContent = `Cashed out! Winnings: ${winnings.toFixed(2)} Robux`;

            robux += winnings;
            document.getElementById("currentRobux").textContent = robux.toFixed(2);

            // Reveal all mines when cashing out
            for (let i = 0; i < rows; i++) {
                for (let j = 0; j < cols; j++) {
                    if (board[i][j] === "M") {
                        const cellElement = document.querySelector(`.cell[data-row="${i}"][data-col="${j}"]`);
                        if (!cellElement.classList.contains("revealed")) {
                            cellElement.classList.add("mine");
                            cellElement.textContent = "M";
                        }
                    }
                }
            }

            gameActive = false;
            document.querySelector("#controls button[onclick='cashOut()']").disabled = true;
            document.getElementById("currentBet").textContent = 0;
            gameStarted = false;
            saveRobux(robux);
        }


        function addRobux() {
            const amount = parseInt(document.getElementById("adminRobuxAmount").value, 10);
            if (!isNaN(amount) && amount > 0) {
                robux += amount;
                document.getElementById("currentRobux").textContent = robux.toFixed(2);
                document.getElementById("adminRobuxAmount").value = "";
                saveRobux(robux);
                localStorage.removeItem('redeemedCodes');
            } else {
                alert("Please enter a valid positive number.");
            }
        }

        function logout() {
            localStorage.removeItem('loggedInUser');
            window.location.href = "Silv3rFlip.html";
        }

        function pickRandomTile() {
            if (!gameActive) return;
            let unrevealedCells = [];
            document.querySelectorAll(".cell:not(.revealed)").forEach(cell => {
                unrevealedCells.push({
                    row: parseInt(cell.dataset.row),
                    col: parseInt(cell.dataset.col)
                });
            });

            if (unrevealedCells.length === 0) return;

            let randomCell = unrevealedCells[Math.floor(Math.random() * unrevealedCells.length)];
            handleCellClick(randomCell.row, randomCell.col);
        }

        function openDepositModal() {
            document.getElementById('deposit-modal').style.display = 'block';
        }

        function closeDepositModal() {
            document.getElementById('deposit-modal').style.display = 'none';
        }

        function redeemCode() {
            const code = document.getElementById('depositCode').value;
            const ipAddress = getIPAddress();
            const redeemedCodes = JSON.parse(localStorage.getItem('redeemedCodes')) || {};

            if (redeemedCodes[ipAddress] && redeemedCodes[ipAddress].includes(code)) {
                alert("This code has already been redeemed.");
                return;
            }

            const codeValues = {
                "aBcD123eFgHi": 10,
                "vBnM3qWeRtYu": 20,
                "xCVb1nMQwE2r": 30,
                "lZxC1vBnM2qW": 40,
                "GhJ3kLZxC4vB": 50,
                "456jKlMnOpQr": 60,
                "iOp4aSdFgHjK": 70,
                "uIoP3aSdFgH4": 80,
                "tY3uIoPa4sDf": 90,
                "eR3tY4uIoP5a": 100,

                "StUvW789xYz0": 10,
                "lZx5cVbNm6QW": 20,
                "jKlZ5xCVbNm6": 30,
                "GhJ5kLZxC6vB": 40,
                "SdF6gHjKlZ7x": 50,
                "oP7aSdFgH8jK": 60,
                "tY0uIoPa1sDf": 70,
                "WeR1tY2uIoP3": 80,
                "nM3qWeRtY4uI": 90,
                "xCVb5nM6qWeR7": 100,

                "QwErT1yUiOpA": 10,
                "SdFgH2jKlZxCv": 20,
                "BnM3qWeRtYuiO": 30,
                "PaSdF4gHjKlZx": 40,
                "CvBnM5qWeRtYu": 50,
                "IoPaS6dFgHjKl": 60,
                "ZxCvB7nMqWeRt": 70,
                "YuIoP8aSdFgHj": 80,
                "KlZxC9vBnMQwE": 90,
                "RtYuI0oPaSDFg": 100,

                "AsDfG1hJkLzX": 10,
                "CvBnM2qWeRtY": 20,
                "UiOpA3sDfGhJ": 30,
                "KlZxC4vBnMQw": 40,
                "ErTyU5iOpAsD": 50,
                "FgHjK6lZxCvB": 60,
                "NmQwE7rTyUiO": 70,
                "PaSdF8gHjKlZ": 80,
                "XcvBn9mQwErT": 90,
                "YuIoP0aSdFgH": 100,

                "ZaQxSwCdVe": 10,
                "RfTgYhUjIk": 20,
                "OlPkMjInHb": 30,
                "GvFcDxSzAe": 40,
                "WrEtYuIoPa": 50,
                "SdFgHjKlZc": 60,
                "VbNmQwErTy": 70,
                "UiOpAsDfGh": 80,
                "JkLzXcvBnM": 90,
                "QwErTyUiOp": 100,

                "ohRpwslhkW": 10,
                "Hjiekw?SDg": 20,
                "HrejhKSK?h": 30,
                "Hjuamhwsdh": 40,
                "GJ37wDnhwa": 50,
                "Hj5e3khshs": 60,
                "hjsUh8s4sG": 70,
                "GnsuzSjhdS": 80,
                "GlslWoAskn": 90,
                "SlhnkWik35": 100,

                "JKhzw4ejgRB!tgeGs": 1000,
                "neazwhthsnBathsbs": 1000,
                "hekri!DB5zmesfh_h": 1000,
                "Z%43ijSnuh5jelfys": 1000,
                "rzo4O489bos,h5dsh": 1000,

                "jig!K,SBmnh4FntbwmIBNFKTWB458izK": 10000,
                "tui4hzbKDtghu4kbMSDBghIW!%bbz457": 10000,
                "4ijzabwtaw47zbtiaw4bjtza5uizkaj3": 10000,
            };

            if (codeValues.hasOwnProperty(code)) {
                robux += codeValues[code];
                document.getElementById("currentRobux").textContent = robux.toFixed(2);
                saveRobux(robux);
                closeDepositModal();
                alert(`Code redeemed! ${codeValues[code]} Robux added.`);

                if (!redeemedCodes[ipAddress]) {
                    redeemedCodes[ipAddress] = [];
                }
                redeemedCodes[ipAddress].push(code);
                localStorage.setItem('redeemedCodes', JSON.stringify(redeemedCodes));
            } else {
                alert("Invalid code.");
            }
        }

        function getIPAddress() {
            return localStorage.getItem('userIP') || 'unknownIP';
        }

        if (!localStorage.getItem('userIP')) {
            localStorage.setItem('userIP', Math.floor(Math.random() * 1000000).toString());
        }
    </script>
</body>

</html>
